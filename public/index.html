<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <title>Simple Polygon</title>
  <style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */

    #map {
      height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */

    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }
  </style>

</head>

<body>
  <div id="map"></div>
  <script>
    let proLat = 0,
      proLong = 0;


    function initMap() {
      var map = new google.maps.Map(document.getElementById('map'), {
        zoom: 6,
        center: {
          lat: 12.8797,
          lng: 121.7740
        },
        mapTypeId: 'roadmap'
      });

      fetch('http://localhost:3000/data.json')
        .then(response => response.json())
        .then(result => result.map(element => {
          let provName = `${element.provinceName}`
          let provPopulation = `${element.population}`
          let provCoords = JSON.parse(element.coordinates)
          let proCenterCoords = JSON.parse(element.centerCoords)
          let posLat = proCenterCoords[1]
          let posLong = proCenterCoords[0]

          let randomColor = '#' + (Math.random() * 0xFFFFFF << 0).toString(16);

          let shape = new google.maps.Polygon({
            paths: provCoords,
            strokeColor: `${randomColor}`,
            strokeOpacity: 0.8,
            strokeWeight: 2,
            fillColor: `${randomColor}`,
            fillOpacity: 0.35,
            position: {
              "lat": posLat,
              "lng": posLong
            }
          });

          let contentString = `<div id="content">` +
            `<h3 id="firstHeading">${provName}</h3>` +
            `<p>Population Number: <b>${provPopulation}</b><p>` +
            `</div>`;

          let infowindow = new google.maps.InfoWindow({
            content: contentString,
            maxWidth: 200
          });

          shape.setMap(map);

          shape.addListener('mouseover', function() {
            infowindow.setPosition({
              "lat": proLat,
              "lng": proLong
            });
            infowindow.open(map, shape);
          });

          shape.addListener('mouseout', function() {
            infowindow.close(map, shape);
          });
        }));
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDl32dSXGt7MYeJnkofk4mARVT4VUF5Poo&callback=initMap">
  </script>
</body>

</html>
